var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Game=function(t){function e(){var e=t.call(this)||this;return e.totalStep=10,e.stepArray=[],e.startX=200,e.metersCount=0,e.wordArray=["a","p","p","l","e"],e.mainObject=e.createBitmapByName("beibei_png"),e.objectWH=80,e.objectPoint=new egret.Point(0,0),e.objectBeginY=350,e.touchPoint=new egret.Point(0,0),e.guideLine=new egret.Shape,e.maxLen=150,e.hasHit=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.onAddToStage=function(t){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.addCloud();for(var e=0;e<this.totalStep;e++){var i=this.createBitmapByName("ladder_png");if(i.y=this.objectBeginY+this.objectWH,i.x=100*Math.random()+200*e+120,i.width=120,i.height=25,this.addChild(i),0==e&&(i.x=this.startX-i.width/2),e>0&&e<this.wordArray.length+1){var o=new egret.TextField;o.x=i.x,o.y=i.y-40,o.width=120,o.height=40,o.textColor=16711680,o.textAlign=egret.HorizontalAlign.CENTER,o.size=30,o.text=this.wordArray[e-1]}this.stepArray.push(i)}this.mainObject.width=this.objectWH,this.mainObject.height=this.objectWH,this.mainObject.x=this.startX-this.mainObject.width/2,this.mainObject.y=this.objectBeginY,this.addChild(this.mainObject),this.objectPoint.x=this.mainObject.x+this.objectWH/2,this.objectPoint.y=this.mainObject.y+this.objectWH,this.addTouchEvent(),this.metersLabel=new egret.TextField,this.metersLabel.x=0,this.metersLabel.y=20,this.metersLabel.width=this.stageW,this.metersLabel.height=55,this.metersLabel.textColor=16711680,this.metersLabel.textAlign=egret.HorizontalAlign.CENTER,this.metersLabel.size=30,this.metersLabel.text="您已经走了"+this.metersCount+"米",this.addChild(this.metersLabel)},e.prototype.addTouchEvent=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},e.prototype.removeTouchEvent=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},e.prototype.touchBegin=function(t){this.touchPoint.x=t.localX,this.touchPoint.y=t.localY,this.hasHit=!1},e.prototype.touchMove=function(t){this.guideLine.graphics.clear(),t.localY<0&&(this.moveToY=0,console.log("超出屏幕")),this.moveToX=this.objectPoint.x+(t.localX-this.touchPoint.x),this.moveToY=this.objectPoint.y+(t.localY-this.touchPoint.y);var e=Math.pow(this.moveToX-this.objectPoint.x,2),i=Math.pow(this.moveToY-this.objectPoint.y,2);if(this.lineLen=Math.sqrt(e+i),this.lineLen>this.maxLen){this.lineLen=this.maxLen;var o=t.localX-this.touchPoint.x,s=t.localY-this.touchPoint.y,h=Math.sqrt(o*o+s*s),n=this.maxLen*o/h,r=this.maxLen*s/h;this.moveToX=this.objectPoint.x+n,this.moveToY=this.objectPoint.y+r}this.moveToX<this.objectPoint.x&&(this.moveToX=this.objectPoint.x),this.moveToY>this.objectPoint.y&&(this.moveToY=this.objectPoint.y);var a=(this.moveToX-this.objectPoint.x)/this.lineLen;console.log(a*Math.PI/180);var c=this.objectPoint.x+(this.moveToX-this.objectPoint.x)/2,d=this.objectPoint.y+(this.moveToY-this.objectPoint.y)/2-20;this.guideLine.graphics.lineStyle(5,16711680),this.guideLine.graphics.moveTo(this.objectPoint.x,this.objectPoint.y),this.guideLine.graphics.curveTo(c,d,this.moveToX,this.moveToY),this.guideLine.graphics.endFill(),this.addChild(this.guideLine)},e.prototype.touchEnd=function(t){this.guideLine.graphics.clear(),this.removeTouchEvent(),this.highX=this.objectPoint.x+4*(this.moveToX-this.objectPoint.x),this.highY=this.objectPoint.y-this.objectWH-4*(this.objectPoint.y-this.moveToY),egret.Tween.get(this).to({factor:1},1e3).call(function(){if(0==this.hasHit){var t=this.stepArray[0];this.mainObject.x=t.x+t.width/2-this.mainObject.width/2,this.mainObject.y=this.objectBeginY}this.addTouchEvent()},this)},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.mainObject.x=(1-t)*(1-t)*this.objectPoint.x+2*t*(1-t)*this.highX+t*t*(2*this.highX-this.objectPoint.x),this.mainObject.y=(1-t)*(1-t)*(this.objectPoint.y-this.objectWH)+2*t*(1-t)*(this.highY-300)+t*t*(this.stageH-this.objectWH),this.observeHit()},enumerable:!0,configurable:!0}),e.prototype.observeHit=function(){for(var t=0;t<this.stepArray.length;t++){var e=this.stepArray[t],i=e.hitTestPoint(this.mainObject.x+this.mainObject.width/2,this.mainObject.y+this.mainObject.height,!0);i&&this.hitAction(t)}},e.prototype.hitAction=function(t){this.mainObject.y=this.objectBeginY,egret.Tween.removeTweens(this),this.hasHit=!0;var e=this.stepArray[t].x+this.stepArray[t].width/2-this.startX;this.metersCount+=Math.round(e/100),this.metersLabel.text="您已经走了"+this.metersCount+"米";for(var i=0;i<this.stepArray.length;i++){var o=this.stepArray[i];egret.Tween.get(o).to({x:o.x-e},300)}egret.Tween.get(this.mainObject).to({x:this.startX-this.mainObject.width/2},300);for(var s=0;t>s;s++)this.removeChild(this.stepArray[s]);this.stepArray.splice(0,t),this.newCount=t;var h=new egret.Timer(350,1);h.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.tweenComplete,this),h.start()},e.prototype.tweenComplete=function(){for(var t=this.stepArray[this.stepArray.length-1],e=0;e<this.newCount;e++){var i=this.createBitmapByName("ladder_png");i.y=this.objectBeginY+this.objectWH,i.x=100*Math.random()+200*e+t.x+250,i.width=120,i.height=25,this.addChild(i),this.stepArray.push(i)}this.addTouchEvent()},e.prototype.speedUp=function(){var t=new egret.Timer(350,20);t.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),t.start()},e.prototype.timerFunc=function(){},e.prototype.timerComFunc=function(){},e.prototype.addCloud=function(){var t=new egret.Sprite;t.graphics.beginFill(8046029,1),t.graphics.drawRect(0,0,this.stageW,this.stageH),t.graphics.endFill(),this.addChild(t);var e=this.createBitmapByName("yun01_png");e.x=20,e.y=111,e.width=97,e.height=70,this.addChild(e),egret.Tween.get(e,{loop:!0}).to({x:this.stageW},35e3).to({x:-100},35e3);var i=this.createBitmapByName("yun03_png");i.x=200,i.y=211,i.width=144,i.height=82,this.addChild(i),egret.Tween.get(i,{loop:!0}).to({x:this.stageW},5e4).to({x:-200},5e4);var o=this.createBitmapByName("yun02_png");o.x=640,o.y=500,o.width=73,o.height=44,this.addChild(o),egret.Tween.get(o,{loop:!0}).to({x:-100},3e4).to({x:this.stageW},3e4);var s=this.createBitmapByName("yun04_png");s.x=40,s.y=644,s.width=112,s.height=76,this.addChild(s),egret.Tween.get(s,{loop:!0}).to({x:this.stageW},4e4).to({x:-120},4e4)},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=new Game;this.addChild(t),RES.getResAsync("description_json",this.startAnimation,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");