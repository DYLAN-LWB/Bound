var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Game=function(t){function e(){var e=t.call(this)||this;return e.stepArray=[],e.startX=200,e.mainObject=e.createBitmapByName("beibei_png"),e.objectWH=80,e.objectPoint=new egret.Point(0,0),e.objectBeginY=400,e.touchPoint=new egret.Point(0,0),e.guideLine=new egret.Shape,e.maxLen=150,e.hasHit=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.onAddToStage=function(t){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=new egret.Sprite;e.graphics.beginFill(8046029,1),e.graphics.drawRect(0,0,this.stageW,this.stageH),e.graphics.endFill(),this.addChild(e);for(var i=0;7>i;i++){var o=this.createBitmapByName("ladder_png");o.y=this.objectBeginY+this.objectWH,o.x=100*Math.random()+200*i+100,o.width=150,o.height=25,this.addChild(o),0==i&&(o.x=this.startX-o.width/2),this.stepArray.push(o)}this.mainObject.width=this.objectWH,this.mainObject.height=this.objectWH,this.mainObject.x=this.startX-this.mainObject.width/2,this.mainObject.y=this.objectBeginY,this.addChild(this.mainObject),this.objectPoint.x=this.mainObject.x+this.objectWH/2,this.objectPoint.y=this.mainObject.y+this.objectWH,this.addTouchEvent()},e.prototype.addTouchEvent=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},e.prototype.removeTouchEvent=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},e.prototype.touchBegin=function(t){this.touchPoint.x=t.localX,this.touchPoint.y=t.localY,this.hasHit=!1},e.prototype.touchMove=function(t){this.guideLine.graphics.clear(),t.localY<0&&(this.moveToY=0,console.log("超出屏幕")),this.moveToX=this.objectPoint.x+(t.localX-this.touchPoint.x),this.moveToY=this.objectPoint.y+(t.localY-this.touchPoint.y);var e=Math.pow(this.moveToX-this.objectPoint.x,2),i=Math.pow(this.moveToY-this.objectPoint.y,2);if(this.lineLen=Math.sqrt(e+i),this.lineLen>this.maxLen){this.lineLen=this.maxLen;var o=t.localX-this.touchPoint.x,s=t.localY-this.touchPoint.y,n=Math.sqrt(o*o+s*s),h=this.maxLen*o/n,r=this.maxLen*s/n;this.moveToX=this.objectPoint.x+h,this.moveToY=this.objectPoint.y+r}this.moveToX<this.objectPoint.x&&(this.moveToX=this.objectPoint.x),this.moveToY>this.objectPoint.y&&(this.moveToY=this.objectPoint.y);var a=this.objectPoint.x+(this.moveToX-this.objectPoint.x)/2,c=this.objectPoint.y+(this.moveToY-this.objectPoint.y)/2-20;this.guideLine.graphics.lineStyle(5,16777215),this.guideLine.graphics.moveTo(this.objectPoint.x,this.objectPoint.y),this.guideLine.graphics.curveTo(a,c,this.moveToX,this.moveToY),this.guideLine.graphics.endFill(),this.addChild(this.guideLine)},e.prototype.touchEnd=function(t){this.guideLine.graphics.clear(),this.removeTouchEvent(),this.highX=this.objectPoint.x+3*(this.moveToX-this.objectPoint.x),this.highY=this.objectPoint.y-this.objectWH-3*(this.objectPoint.y-this.moveToY),egret.Tween.get(this).to({factor:1},1e3).call(function(){if(0==this.hasHit){var t=this.stepArray[0];this.mainObject.x=t.x+t.width/2-this.mainObject.width/2,this.mainObject.y=this.objectBeginY}this.addTouchEvent()},this)},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.mainObject.x=(1-t)*(1-t)*this.objectPoint.x+2*t*(1-t)*this.highX+t*t*(2*this.highX-this.objectPoint.x),this.mainObject.y=(1-t)*(1-t)*(this.objectPoint.y-this.objectWH)+2*t*(1-t)*(this.highY-300)+t*t*(this.stageH-this.objectWH);for(var e=0;e<this.stepArray.length;e++){var i=this.stepArray[e],o=i.hitTestPoint(this.mainObject.x+this.mainObject.width/2,this.mainObject.y+this.mainObject.height,!0);if(o){console.log("isHit"),this.mainObject.y=this.objectBeginY,egret.Tween.removeTweens(this),this.hasHit=!0;for(var s=this.stepArray[e].x+this.stepArray[e].width/2-this.startX,n=0;n<this.stepArray.length;n++){var h=this.stepArray[n];egret.Tween.get(h).to({x:h.x-s},300)}egret.Tween.get(this.mainObject).to({x:this.startX-this.mainObject.width/2},300);for(var r=0;e>r;r++)this.removeChild(this.stepArray[r]);this.stepArray.splice(0,e),console.log(this.stepArray.length);for(var a=this.stepArray[this.stepArray.length-1],c=0;e>c;c++){var d=this.createBitmapByName("ladder_png");d.y=this.objectBeginY+this.objectWH,d.x=100*Math.random()+200*c+a.x-50,d.width=150,d.height=25,this.addChild(d),this.stepArray.push(d)}this.addTouchEvent()}}},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=new Game;this.addChild(t),RES.getResAsync("description_json",this.startAnimation,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");